<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Event | Event Platform</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      background: #f8faff;
      color: #333;
      padding: 30px;
    }
    h2 {
      margin-bottom: 20px;
      font-weight: 600;
      color: #222;
    }
    .layout {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 30px;
      align-items: start;
    }
    .card {
      background: #fff;
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      transition: transform 0.2s ease;
    }
    .card:hover { transform: translateY(-2px); }

    form input, form textarea, form select, form button {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 0.95rem;
      transition: border 0.2s ease;
    }
    form input:focus, form textarea:focus, form select:focus {
      border-color: #2979ff;
      outline: none;
      box-shadow: 0 0 6px rgba(41,121,255,0.3);
    }
    form button {
      background: #2979ff;
      color: #fff;
      border: none;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 3px 10px rgba(41,121,255,0.3);
      transition: 0.3s;
    }
    form button:hover {
      background: #155edc;
      transform: translateY(-1px);
    }

    .events-section h2 {
      margin-bottom: 15px;
    }
    .event {
      background: #fff;
      padding: 20px;
      border-radius: 14px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.06);
      position: relative;
      animation: fadeIn 0.4s ease;
    }
    .priority-badge {
      position: absolute;
      top: 16px;
      right: 16px;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      color: white;
    }
    .low { background: #00c853; }
    .medium { background: #ff9800; }
    .high { background: #e53935; }
    .event h3 {
      font-size: 1.2rem;
      margin-bottom: 8px;
      color: #111;
    }
    .event-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 6px 16px;
      font-size: 0.9rem;
      margin-top: 8px;
      color: #444;
    }
    .event-details p { margin: 0; }
    .event button {
      margin-top: 12px;
      background: #ff7043;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
      box-shadow: 0 3px 8px rgba(255,112,67,0.25);
    }
    .event button:hover { background: #f4511e; }

    #showEventsBtn {
      display: inline-block;
      margin-bottom: 20px;
      background: #00c853;
      padding: 12px 20px;
      border-radius: 10px;
      color: white;
      font-weight: 600;
      border: none;
      cursor: pointer;
      box-shadow: 0 3px 10px rgba(0,200,83,0.3);
      transition: 0.3s;
    }
    #showEventsBtn:hover { background: #00963f; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- Create Event Form -->
    <div class="card">
      <h2>‚ûï Create Event</h2>
      <form id="eventForm">
        <input type="text" name="title" placeholder="Event Title" required>
        <textarea name="description" placeholder="Description"></textarea>
        <input type="date" name="date" required>
        <input type="text" name="location" placeholder="Location">
        <input type="number" name="capacity" placeholder="Capacity">
        <input type="number" step="0.01" name="price" placeholder="Price">
        <select name="priority">
          <option value="low">Low Priority</option>
          <option value="medium">Medium Priority</option>
          <option value="high">High Priority</option>
        </select>
        <button type="submit">Create Event</button>
      </form>
    </div>

    <!-- Events Section -->
    <div class="events-section">
      <button id="showEventsBtn">üìã Show Events</button>
      <h2>All Events</h2>
      <div id="eventsContainer"></div>

      <h2>Completed Events</h2>
      <div id="completedEvents"></div>
    </div>
  </div>

  <script>
    const token = localStorage.getItem("token");
    if(!token) window.location.href = "login.html";

    const form = document.getElementById("eventForm");
    const showBtn = document.getElementById("showEventsBtn");
    const container = document.getElementById("eventsContainer");
    const completedContainer = document.getElementById("completedEvents");

    form.addEventListener("submit", async function(e){
      e.preventDefault();
      const data = {
        title: this.title.value,
        description: this.description.value,
        date: this.date.value,
        location: this.location.value,
        capacity: parseInt(this.capacity.value),
        price: parseFloat(this.price.value),
        priority: this.priority.value
      };

      try {
        const res = await fetch("/events", {
          method: "POST",
          headers: { 
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
          },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        alert(result.success ? "‚úÖ Event Created Successfully!" : result.error);
        form.reset();
      } catch(err) {
        alert("‚ùå Error: " + err.message);
      }
    });

    async function fetchEvents() {
      try {
        const res = await fetch("/events", {
          headers: { "Authorization": "Bearer " + token }
        });
        const events = await res.json();
        container.innerHTML = "";
        completedContainer.innerHTML = "";
        if(events.length === 0) {
          container.innerHTML = "<p>No events found.</p>";
        } else {
          events.forEach(ev => {
            const div = document.createElement("div");
            div.className = "event";
            div.innerHTML = `
              <span class="priority-badge ${ev.priority.toLowerCase()}">${ev.priority}</span>
              <h3>${ev.title}</h3>
              <div class="event-details">
                <p><strong>üìÖ Date:</strong> ${new Date(ev.date).toLocaleDateString()}</p>
                <p><strong>üìç Location:</strong> ${ev.location || "N/A"}</p>
                <p><strong>üë• Capacity:</strong> ${ev.capacity || 0}</p>
                <p><strong>‚úÖ Booked:</strong> ${ev.bookedSeats || 0}</p>
                <p><strong>üí≤ Price:</strong> $${ev.price || 0}</p>
                <p><strong>üìù Description:</strong> ${ev.description || "N/A"}</p>
              </div>
            `;
            if (!ev.iscompleted) {
              const doneBtn = document.createElement("button");
              doneBtn.textContent = "‚úî Mark as Done";
              doneBtn.onclick = async () => {
                await fetch("/events/" + ev._id + "/complete", {
                  method: "PUT",
                  headers: { "Authorization": "Bearer " + token }
                });
                fetchEvents();
              };
              div.appendChild(doneBtn);
              container.appendChild(div);
            } else {
              completedContainer.appendChild(div);
            }
          });
        }
      } catch(err) {
        container.innerHTML = "<p>Error fetching events.</p>";
      }
    }

    showBtn.addEventListener("click", fetchEvents);
  </script>
</body>
</html>
